<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ESP32 Relay Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
   :root { 
      --bg:#0f172a; 
      --card:#111827; 
      --text:#e5e7eb; 
      --muted:#9ca3af; 
      --accent:#60a5fa; 
      --danger:#f87171; 
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:linear-gradient(180deg,#0b1220,#0f172a 30%);
      min-height:100vh; display:flex; align-items:center; justify-content:center; color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .card{
      width:min(680px,92vw); background:var(--card); border-radius:18px; padding:22px;
      box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.06);
    }
    h1{margin:0 0 6px;font-size:22px;letter-spacing:.2px}
    .grid{
      display:grid; grid-template-columns: repeat(1, 1fr); gap:12px;
    }
    .cell{
      background:rgba(255,255,255,.02); padding:14px; border-radius:14px; border:1px solid rgba(255,255,255,.05)
    }
    .name{font-size:14px;margin:0 0 10px;color:#cbd5e1;display:flex;justify-content:space-between;align-items:center}

    /* Slider toggle with glow */
    .switch {
      position: relative;
      width: 70px;
      height: 36px;
      background: var(--danger);
      border-radius: 40px;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      box-shadow: inset 0 2px 6px rgba(0,0,0,.4);
    }
    .switch::before {
      content: "";
      position: absolute;
      width: 30px;
      height: 30px;
      top: 3px;
      left: 3px;
      background: white;
      border-radius: 50%;
      transition: transform 0.35s cubic-bezier(.45,1.8,.5,1), background 0.3s;
      box-shadow: 0 3px 8px rgba(0,0,0,.3);
    }
    .switch.on {
      background: var(--accent);
      box-shadow: 0 0 10px rgba(96,165,250,.6),
                  0 0 30px rgba(96,165,250,.3),
                  inset 0 2px 6px rgba(0,0,0,.4);
    }
    .switch.on::before {
      transform: translateX(34px);
      background: #e0f2fe;
      box-shadow: 0 0 8px rgba(96,165,250,.8);
    }
    .state-label {
      font-size: 12px;
      color: var(--muted);
      text-align: right;
      margin-top: 6px;
      letter-spacing:.3px;
    }

    .footer{margin-top:14px; font-size:12px; color:var(--muted); text-align:right}
 
  </style>

  <script>
    async function send(path) {
      try {
        const r = await fetch(path, { cache: "no-store" });
        if (!r.ok) throw new Error("HTTP " + r.status);
      } catch (e) {
        alert("Request failed: " + e.message);
      }
      updateUI(); // refresh state
    }

    async function updateUI() {
      try {
        const r = await fetch("/status", { cache: "no-store" });
        const st = await r.json();
        for (let i=1; i<=3; i++) {
          const sw = document.getElementById("relay"+i);
          const lbl = document.getElementById("lbl"+i);
          if (st["relay"+i]) {
            sw.classList.add("on");
            lbl.textContent = "ON";
            lbl.style.color = "var(--accent)";
          } else {
            sw.classList.remove("on");
            lbl.textContent = "OFF";
            lbl.style.color = "var(--danger)";
          }
        }
      } catch (e) { console.error("Status error", e); }
    }

    function toggleRelay(num) {
      const sw = document.getElementById("relay"+num);
      const isOn = sw.classList.contains("on");
      send(`/relay${num}?${isOn ? "off" : "on"}`);
    }

    window.onload = () => { 
      updateUI(); 
      setInterval(updateUI, 1000); 
    };
  </script>
</head>

<body>
  <div class="card">
    <h1>ESP32 Relay Control</h1>
    <div class="grid">

      <div class="cell">
        <div class="name">
          <span>Pasillo</span>
          <div id="relay1" class="switch" onclick="toggleRelay(1)"></div>
        </div>
        <div id="lbl1" class="state-label">—</div>
      </div>

      <div class="cell">
        <div class="name">
          <span>Cocina</span>
          <div id="relay2" class="switch" onclick="toggleRelay(2)"></div>
        </div>
        <div id="lbl2" class="state-label">—</div>
      </div>

      <div class="cell">
        <div class="name">
          <span>Living</span>
          <div id="relay3" class="switch" onclick="toggleRelay(3)"></div>
        </div>
        <div id="lbl3" class="state-label">—</div>
      </div>

    </div>
    <div class="footer">Served by Embassy + esp-wifi</div>
  </div>
</body>
</html>
